
Авторизация без SDK для Web
Важно. Если вы интегрируете VK ID без SDK, способы авторизации по One Tap, с помощью шторки авторизации или через 3 в 1 будут недоступны.
Перед настройкой авторизации убедитесь, что в кабинете сервиса авторизации VK ID приложение создано и настроено. Чтобы подключить авторизацию VK ID на сайте по ссылке, самостоятельно соберите параметры для этой ссылки. Реализуйте открытие ссылки, когда пользователь нажимает на кнопку авторизации, которую вы разместили на вашем сайте.
Обратите внимание
Кнопка авторизации VK ID должна соответствовать требованиям к дизайну.
Шаг 1. Выберите способ интеграции VK ID
Если ваше веб-приложение разделяется фронтенд и бэкенд, используйте авторизацию без SDK с обменом кода на бэкенде. Если такого разделения нет, используйте авторизацию без SDK с обменом кода на фронтенде.
Шаг 2. Подготовка параметров для авторизации
Подготовьте данные для авторизации и сохраните их в строку. На базе Proof Key for Code Exchange (PKCE) реализуйте безопасное получение кода авторизации. Для тестирования рекомендуем генерировать code_verifier и code_challenge с помощью сервиса Online PKCE Generator Tool. Пример

https://id.vk.com/authorize?response_type=code&client_id=12345&scope=email%20phone&redirect_uri=https%3A%2F%2Fyour.site&state=XXXRandomZZZ&code_challenge=K8KAyQ82WSEncryptedVerifierGYUDj8K&code_challenge_method=S256

Описание параметров
Обязательные параметры
Параметр	Описание
response_type	Требуемый ответ. При запросе кода подтверждения следует указать значение code
client_id	Идентификатор приложения, которое запрашивает авторизацию. Это значение можно найти в параметрах приложения
code_challenge	Значение code_verifier, преобразованное с помощью code_challenge_method и закодированное в base64. Порядок преобразований: BASE64-ENCODE(S256(codeVerifier)) RFC-7636 Code Challenge. Применяется при использовании расширения PKCE для защиты передаваемых данных. Генерируется приложением для последующей проверки, что запрос токена поступает от того же приложения, которое запросило авторизацию. Параметр обязателен для обмена кода на токен на фронтенде
code_challenge_method	Метод преобразования code_verifier в code_challenge. Принимает значение S256
redirect_uri	Веб-страница, куда нужно перенаправить пользователя после того, как он разрешил приложению доступ. На этот адрес возвращаются авторизационный код code, строка состояния state и идентификатор устройства device_id. Затем происходит обмен кода на токены.
Требования к содержимому веб-страницы для обмена кода

В качестве адреса веб-страницы используйте доверенный redirect URL, указанный в настройках приложения. Полученный идентификатор устройства сохраните на клиенте для его дальнейшей передачи в запросах.

После обмена кода на токены ваше клиентское приложение должно перенаправить пользователя на конечную страницу в авторизованной зоне. Если URL этой страницы передается параметром — проверьте его валидность. В противном случае злоумышленник может подменить URL конечной страницы, подставив URL своего сайта. Например, если адрес перенаправления выглядит как redirect_uri=https://your.domain/callback_vk?return_to=https://your.domain/user_profile, то убедитесь, что адрес в поле rerturn_to — это ваш сайт.
state	Строка состояния в виде случайной строки, состоящей из символов: a-z, A-Z, 0-9, _, -, длиной не менее 32 символа. Передается на старте авторизации и должна возвращаться клиентскому приложению без изменения. Иначе ответ можно считать подмененным
Дополнительные параметры
Параметр	Описание
scope	Список прав доступа, которые нужны приложению. Значения в списке разделяются пробелами, например: email phone. Если параметр не указан, то берется минимальное значение прав доступа по умолчанию для приложений — vkid.personal_info
lang_id	Язык интерфейса. По умолчанию используется значение 0 (русский язык). Возможные значения: RUS = 0,UKR = 1,ENG = 3,SPA = 4,GERMAN = 6,POL = 15,FRA = 16,TURKEY = 82
scheme	Тема формы запроса разрешений. По умолчанию используется значение light (дневная тема). Возможные значения: light, dark
Шаг 3. Запуск авторизации
Вы можете запустить авторизацию несколькими способами:

    с редиректом в рамках одной вкладки;
    в новой вкладке;
    в новом окне.

Когда пользователь нажимает на кнопку авторизации, выполните следующий код, чтобы запустить авторизацию:
Редирект в рамках одной вкладки
В новой вкладке
В новом окне

location.assign('https://id.vk.com/authorize' + query);

В результате будет выполнен переход на страницу авторизации с редиректом в рамках одной вкладки, в новой вкладке или в новом окне — в зависимости от выбранного вами способа.
Обработка результата авторизации
После успешного входа в VK ID произойдет редирект на адрес, указанный в redirect_uri. Данные авторизации пользователя вы найдете в url в параметре payload. Внутри payload полученной ссылки достаньте code и state и проверьте, что state совпадает со state из первого шага. Таким образом можно убедиться в том, что это ответ на ваш запрос.

{
  "code": "{string}",
  "state": "{string}",
  "type": "code_v2",
  "device_id": "{string}"
}

Шаг 4. Сохранение device ID
Сохраните полученнный device_id и используйте в запросах обмена кода авторизации и Refresh token.
Шаг 5. Получение Access token
Обменяйте code на access_token с помощью HTTP-запроса API.
Пример запроса

curl "https://id.vk.com/oauth2/auth" -d "client_id=7915193&grant_type=authorization_code&code_verifier=KnHKAdqyW57MUbjRcScaZRU9Bw26Kez9zwBgti779zU&device_id=1111&code=1f06e0c317b5b524c6&redirect_uri=https://vk.com/blank.html"

Описание параметров запроса
Название	Описание
grant_type	Всегда равно authorization_code
code	Код авторизации, полученный на втором шаге
code_verifier	code_verifier из первого шага
client_id	Идентификатор приложения. Доступен в параметрах приложения
device_id	Уникальный идентификатор вашего устройства, полученный на втором шаге
redirect_uri	Адрес для редиректа после авторизации. Такой же, как на втором шаге
state	Уникальная строка
Пример ответа

{
  "access_token": "XXXXX",
  "refresh_token": "XXXXX",
  "id_token": "XXXXX",
  "expires_in": 0,
  "user_id": 1234567890,
  "state": "XXX",
  "scope": "email phone"
}

Шаг 6. Получение нового Access token после истечения срока жизни предыдущего
Обменяйте refresh_token на access_token с помощью запроса HTTP-запроса API.
Пример запроса

POST https://id.vk.com/oauth2/auth

Content-Type: application/x-www-form-urlencoded

grant_type=refresh_token&refresh_token=vk2.a.KULQ...GTuz5I&client_id=51812311&device_id=P7UVuD.....G7mw&state=XXFGXrandomZZFD&

Описание параметров запроса
Название	Описание
grant_type	Всегда равно refresh_token
refresh_token	refresh_token, полученный на четвертом шаге
client_id	Идентификатор приложения. Доступен в параметрах приложения
device_id	Уникальный идентификатор вашего устройства, полученный на втором шаге
state	Уникальная строка
Пример ответа

{
  "access_token": "XXXXX",
  "refresh_token": "XXXXX",
  "expires_in": 0,
  "user_id": 1234567890,
  "state": "XXX",
  "scope": "email phone"
}

Шаг 7. Инвалидация токена (выход из аккаунта)
В целях безопасности проинвалидируйте токен с помощью HTTP-запроса API, если вы хотите завершить сессию пользователя.
Пример запроса

curl "https://id.vk.com/oauth2/logout" -d "client_id=7915193&access_token=XXX"

Описание параметров запроса
Название	Описание
access_token	access_token, полученный на четвертом шаге
client_id	Идентификатор приложения. Доступен в параметрах приложения
Пример ответа

{"response":1}

Шаг 8. (Опционально) Получение пользовательских данных
Получите данные пользователя с помощью HTTP-запроса API.
Пример запроса

curl "https://id.vk.com/oauth2/user_info" -d "access_token=XXX"

Описание параметров запроса
Название	Описание
access_token	access_token, полученный на четвертом шаге
client_id	Идентификатор приложения. Доступен в параметрах приложения
Пример ответа

{
    "user": {
        "user_id": "1234567890",
        "first_name": "Ivan",
        "last_name": "Ivanov",
        "phone": "79991234567",
        "avatar": "https://pp.userapi.com/60tZWMo4SmwcploUVl9XEt8ufnTTvDUmQ6Bj1g/mmv1pcj63C4.png",
        "email": "ivan_i123@vk.com",
        "sex": 2,
        "verified": false,
        "birthday": "01.01.2000"
    }
}

Шаг 9. (Опционально) Получение публичных пользовательских данных
Получите публичные маскированные данные пользователя с помощью HTTP-запроса API.
Пример запроса

curl "https://id.vk.com/oauth2/public_info" -d "id_token=XXX"

Описание параметров запроса
Название	Описание
id_token	id_token, полученный на четвертом шаге
client_id	Идентификатор приложения. Доступен в параметрах приложения
Пример ответа

{
    "user": {
        "user_id": "1234567890",
        "first_name": "Ivan",
        "last_name": "I.",
        "phone": "+42872 *** ** 29",
        "avatar": "https://pp.userapi.com/60tZWMo4SmwcploUVl9XEt8ufnTTvDUmQ6Bj1g/mmv1pcj63C4.png",
        "email": "iv***@vk.vom"
    }
}